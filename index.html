<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Calculadora Hidráulica Avançada - GI Digital</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    html, body {
      font-family: 'Inter', Arial, sans-serif;
      background: linear-gradient(120deg, #e0eafc 0%, #f8fafc 100%);
      min-height: 100vh;
      color: #222;
    }
    
    .navbar {
      border-radius: 0 0 18px 18px;
      box-shadow: 0 2px 12px rgba(9,9,53,0.08);
      background: #fff;
      padding: 0.7rem 0;
    }
    
    .navbar-brand {
      font-weight: 700;
      color: #1a237e !important;
      font-size: 1.7rem;
      letter-spacing: 1px;
      display: flex;
      align-items: center;
      gap: 10px;
      text-shadow: 0 2px 8px rgba(26,35,126,0.04);
    }
    
    .card {
      border: none;
      border-radius: 18px;
      box-shadow: 0 6px 32px rgba(26,35,126,0.10);
      background: #fff;
      padding: 2.2rem 2rem 2rem 2rem;
      margin-bottom: 2rem;
      transition: box-shadow 0.2s;
    }
    
    .card:hover {
      box-shadow: 0 10px 40px rgba(26,35,126,0.13);
    }
    
    .form-label {
      font-weight: 600;
      color: #1a237e;
      margin-bottom: 0.2rem;
    }
    
    .input-group-text {
      background: #e3eafc;
      border: none;
      color: #1a237e;
      font-weight: 600;
    }
    
    .form-control, .form-select {
      border-radius: 8px;
      border: 1.5px solid #e3eafc;
      background: #f8fafc;
      font-size: 1.05em;
      transition: border-color 0.2s;
    }
    
    .form-control:focus, .form-select:focus {
      border-color: #1a237e;
      box-shadow: 0 0 0 2px #e3eafc;
      background: #fff;
    }
    
    .form-control.is-invalid, .form-select.is-invalid {
      border-color: #e53935;
      background: #fff0f0;
    }
    
    .btn {
      border-radius: 8px;
      font-weight: 600;
      font-size: 1.08em;
      transition: background 0.2s, color 0.2s, box-shadow 0.2s;
      box-shadow: 0 1px 4px rgba(26,35,126,0.07);
    }
    
    .btn-primary {
      background: linear-gradient(90deg, #1a237e 70%, #3949ab 100%);
      color: #fff !important;
      border: none;
    }
    
    .btn-primary:hover, .btn-primary:focus {
      background: linear-gradient(90deg, #3949ab 70%, #1a237e 100%);
      color: #fff !important;
      box-shadow: 0 2px 12px rgba(26,35,126,0.13);
    }
    
    .btn-outline-primary, .btn-outline-secondary, .btn-outline-success {
      border-width: 2px;
      background: #f8fafc;
      color: #1a237e !important;
    }
    
    .btn-outline-primary:hover, .btn-outline-secondary:hover, .btn-outline-success:hover {
      background: #1a237e !important;
      color: #fff !important;
      border-color: #1a237e !important;
    }
    
    .btn-outline-primary:active, .btn-outline-secondary:active, .btn-outline-success:active {
      background: #3949ab !important;
      color: #fff !important;
    }
    
    .titulo-principal {
      color: #1a237e !important;
      font-weight: 700;
      letter-spacing: 0.5px;
      margin-bottom: 1.5rem;
      text-shadow: 0 2px 8px rgba(26,35,126,0.04);
    }
    
    .resultado {
      background: #f4f8ff;
      border-left: 6px solid #3949ab;
      padding: 22px 28px;
      margin-top: 28px;
      border-radius: 12px;
      font-size: 1.12rem;
      box-shadow: 0 2px 12px rgba(26,35,126,0.07);
      animation: fadeIn 0.7s;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px);}
      to { opacity: 1; transform: translateY(0);}
    }
    
    .table {
      border-radius: 10px;
      overflow: hidden;
      background: #fff;
      margin-bottom: 0;
    }
    
    .table th, .table td {
      vertical-align: middle;
      border: none;
      font-size: 1.04em;
    }
    
    .table thead th {
      background: #e3eafc;
      color: #1a237e;
      font-weight: 700;
      border-bottom: 2px solid #c5cae9;
    }
    
    .table tbody tr:nth-child(even) {
      background: #f8fafc;
    }
    
    .badge {
      font-size: 1em;
      border-radius: 6px;
      padding: 0.5em 0.8em;
      font-weight: 600;
    }
    
    .badge.bg-success {
      background: linear-gradient(90deg, #43e97b 0%, #38f9d7 100%);
      color: #1a237e;
    }
    
    .badge.bg-warning {
      background: linear-gradient(90deg, #ffe259 0%, #ffa751 100%);
      color: #1a237e;
    }
    
    .badge.bg-danger {
      background: linear-gradient(90deg, #ff5858 0%, #f09819 100%);
      color: #fff;
    }
    
    .chart-container {
      background: rgba(244, 248, 255, 0.95);
      border-radius: 14px;
      padding: 22px 16px 18px 16px;
      margin-top: 28px;
      box-shadow: 0 1px 8px rgba(26,35,126,0.06);
      min-height: 350px;
      height: 400px;
    }
    
    canvas {
      min-height: 320px !important;
      height: 380px !important;
      max-width: 100%;
      display: block;
      margin: 0 auto;
      background: transparent;
    }
    
    .table-responsive {
      border-radius: 10px;
      overflow: hidden;
      margin-bottom: 0;
    }
    
    .bi-info-circle {
      font-size: 1.1em;
      vertical-align: middle;
      margin-left: 2px;
      color: #3949ab;
      opacity: 0.8;
    }
    
    .alert-danger {
      background: linear-gradient(90deg, #ffdde1 0%, #ee9ca7 100%);
      color: #b71c1c;
      border: none;
      font-weight: 600;
      border-radius: 8px;
    }
    
    .alert-success {
      background: linear-gradient(90deg, #e0ffe9 0%, #b2fefa 100%);
      color: #1b5e20;
      border: none;
      font-weight: 600;
      border-radius: 8px;
    }
    
    .alert-warning {
      background: linear-gradient(90deg, #fffde4 0%, #f9d423 100%);
      color: #ff6f00;
      border: none;
      font-weight: 600;
      border-radius: 8px;
    }
    
    .table th, .table td {
      padding: 0.7em 1em;
    }
    
    .table th {
      font-size: 1.08em;
    }
    
    .table td {
      font-size: 1.04em;
    }
    
    .table-bordered > :not(caption) > * > * {
      border-width: 0 0 1.5px 0;
      border-color: #e3eafc;
    }
    
    .table-bordered > :not(caption) > *:last-child > * {
      border-bottom-width: 0;
    }
    
    .tooltip-inner {
      background: #3949ab;
      color: #fff;
      font-size: 1em;
      border-radius: 6px;
      padding: 0.5em 1em;
    }
    
    .input-group-text i {
      color: #3949ab;
    }
    
    /* Responsividade */
    @media (max-width: 991px) {
      .card { padding: 1.2rem 0.7rem 1.2rem 0.7rem; }
      .chart-container { padding: 12px 4px 10px 4px; }
      .resultado { padding: 14px 8px; }
    }
    
    @media (max-width: 767px) {
      .navbar-brand { font-size: 1.1rem; }
      .card { padding: 0.7rem !important; }
      .resultado { font-size: 0.98rem; }
      .table-responsive { font-size: 0.95rem; }
      .chart-container { min-height: 220px; height: 260px; }
      canvas { min-height: 180px !important; height: 220px !important; }
    }
  </style>
</head>
<body>
  <nav class="navbar navbar-expand-lg mb-4 sticky-top">
    <div class="container">
      <a class="navbar-brand mx-auto" href="#">
        Calculadora Hidráulica Avançada
      </a>
    </div>
  </nav>
  <div class="container py-4">
    <div class="row justify-content-center">
      <div class="col-lg-8 col-md-10">
        <div class="card p-4">
          <h2 class="text-center mb-4 fw-bold titulo-principal">
            Bombeamento de Caldas Agrícolas
          </h2>
          <form id="form-calc" autocomplete="off">
            <div class="row g-3">
              <div class="col-md-6">
                <label class="form-label" for="volume">
                  Volume da calda (litros)
                  <i class="bi bi-info-circle text-primary" data-bs-toggle="tooltip" title="Volume total da calda a ser bombeada"></i>
                </label>
                <div class="input-group">
                  <span class="input-group-text"><i class="bi bi-droplet"></i></span>
                  <input type="number" id="volume" class="form-control" value="3000" min="1" required />
                </div>
              </div>
              <div class="col-md-6">
                <label class="form-label" for="tempo">
                  Tempo de transferência (min)
                  <i class="bi bi-info-circle text-primary" data-bs-toggle="tooltip" title="Tempo total de bombeamento em minutos"></i>
                </label>
                <div class="input-group">
                  <span class="input-group-text"><i class="bi bi-clock"></i></span>
                  <input type="number" id="tempo" class="form-control" value="3.5" min="0.1" step="0.1" required />
                </div>
              </div>
              <div class="col-md-6">
                <label class="form-label" for="diametro">
                  Diâmetro interno da tubulação (mm)
                  <i class="bi bi-info-circle text-primary" data-bs-toggle="tooltip" title="Diâmetro interno da tubulação em milímetros"></i>
                </label>
                <div class="input-group">
                  <span class="input-group-text">Ø</span>
                  <input type="number" id="diametro" class="form-control" value="110" step="1" min="10" required/>
                </div>
              </div>
              <div class="col-md-6">
                <label class="form-label" for="comprimento">
                  Comprimento da tubulação (m)
                  <i class="bi bi-info-circle text-primary" data-bs-toggle="tooltip" title="Comprimento total da tubulação em metros"></i>
                </label>
                <div class="input-group">
                  <span class="input-group-text"><i class="bi bi-rulers"></i></span>
                  <input type="number" id="comprimento" class="form-control" value="30" min="1" required />
                </div>
              </div>
              <div class="col-md-6">
                <label class="form-label" for="altura">
                  Altura geométrica (m)
                  <i class="bi bi-info-circle text-primary" data-bs-toggle="tooltip" title="Altura vertical entre o ponto de sucção e o ponto de recalque"></i>
                </label>
                <div class="input-group">
                  <span class="input-group-text"><i class="bi bi-arrow-up"></i></span>
                  <input type="number" id="altura" class="form-control" value="2" min="0" required />
                </div>
              </div>
              <div class="col-md-6">
                <label class="form-label" for="material">
                  Material da tubulação
                  <i class="bi bi-info-circle text-primary" data-bs-toggle="tooltip" title="Selecione o material da tubulação"></i>
                </label>
                <select id="material" class="form-select" required>
                  <option value="PVC" selected>PVC</option>
                  <option value="PEAD">PEAD</option>
                  <option value="Aço">Aço</option>
                  <option value="Inox">Inox</option>
                </select>
              </div>
            </div>
            <div class="d-flex gap-2 mt-4 flex-wrap">
              <button type="button" class="btn btn-primary flex-fill" onclick="calcular()">
                <i class="bi bi-play-circle"></i> Calcular
              </button>
              <button type="reset" class="btn btn-outline-secondary flex-fill" onclick="limpar()">
                <i class="bi bi-eraser"></i> Limpar
              </button>
              <button type="button" class="btn btn-outline-primary flex-fill" id="btn-pdf" onclick="exportarPDF()" style="display:none;">
                <i class="bi bi-file-earmark-pdf"></i> Exportar PDF
              </button>
              <button type="button" class="btn btn-outline-success flex-fill" id="btn-print" onclick="window.print()" style="display:none;">
                <i class="bi bi-printer"></i> Imprimir
              </button>
            </div>
          </form>
          <div id="saida" class="resultado mt-4 d-none"></div>
          <div id="grafico" class="chart-container d-none">
            <h6 class="text-primary mb-2"><i class="bi bi-graph-up"></i> Curva de Perda de Carga x Vazão</h6>
            <canvas id="chartHf"></canvas>
          </div>
          <div class="chart-container mt-4">
            <h6 class="text-primary mb-2"><i class="bi bi-bar-chart"></i> Curvas das Bombas</h6>
            <canvas id="graficoBombas"></canvas>
          </div>
        </div>
      </div>
    </div>
  </div>
  <!-- Chart.js CDN -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // Ativa tooltips Bootstrap
    document.addEventListener('DOMContentLoaded', function () {
      var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
      tooltipTriggerList.map(function (tooltipTriggerEl) {
        return new bootstrap.Tooltip(tooltipTriggerEl)
      })
    });

    // Fatores de atrito aproximados por material
    const fatoresAtrito = {
      "PVC": 0.03,
      "PEAD": 0.028,
      "Aço": 0.022,
      "Inox": 0.015
    };

    let chartHf = null;
    let chartBombas = null;

    function calcular() {
      const pi = Math.PI;
      const g = 9.81;
      const nu = 1e-6; // viscosidade cinemática da água a 20°C (m²/s)

      // Entradas
      const V = parseFloat(document.getElementById("volume").value);
      const T = parseFloat(document.getElementById("tempo").value);
      const D = parseFloat(document.getElementById("diametro").value) / 1000; // mm para m
      const L = parseFloat(document.getElementById("comprimento").value);
      const Hgeom = parseFloat(document.getElementById("altura").value);
      const material = document.getElementById("material").value;

      // Validação
      const campos = ["volume", "tempo", "diametro", "comprimento", "altura"];
      let erro = false;
      for (let id of campos) {
        const el = document.getElementById(id);
        if (!el.value || parseFloat(el.value) <= 0) {
          el.classList.add("is-invalid");
          erro = true;
        } else {
          el.classList.remove("is-invalid");
        }
      }
      if (!material) {
        document.getElementById("material").classList.add("is-invalid");
        erro = true;
      } else {
        document.getElementById("material").classList.remove("is-invalid");
      }
      if (erro) {
        document.getElementById("saida").classList.remove("d-none");
        document.getElementById("saida").innerHTML = `<div class="alert alert-danger"><i class="bi bi-exclamation-triangle"></i> Preencha todos os campos corretamente!</div>`;
        document.getElementById("grafico").classList.add("d-none");
        document.getElementById("btn-pdf").style.display = "none";
        document.getElementById("btn-print").style.display = "none";
        return;
      }

      // Cálculos principais
      const Q_m3h = (V / T) * (60 / 1000); // m³/h
      const Q_Lmin = Q_m3h * 1000 / 60; // L/min
      const Q_m3s = Q_m3h / 3600; // m³/s (corrigido de 3.6 para 3600)
      const A = (pi * D * D) / 4; // m²
      const v = Q_m3s / A; // m/s (removida a divisão por 1000)
      const Re = (v * D) / nu; // Número de Reynolds

      // Fator de atrito
      let f = fatoresAtrito[material] || 0.03;

      // Ajuste para regime laminar (Re < 2000)
      if (Re < 2000) {
        f = 64 / Re;
      }

      // Perda de carga linear (Darcy-Weisbach)
      const hf = f * (L / D) * ((v ** 2) / (2 * g));

      // Perda em acessórios (estimativa 15% de hf)
      const percAcessorios = 0.15;
      const hacessorios = hf * percAcessorios;

      // HMT
      const HMT = Hgeom + hf + hacessorios;

      // Tabela de bombas exemplo
      const bombas = [
        { modelo: "2 CV", faixaVazao: [6, 12], faixaHMT: [15, 25] },
        { modelo: "3 CV", faixaVazao: [10, 18], faixaHMT: [18, 32] },
        { modelo: "5 CV", faixaVazao: [16, 28], faixaHMT: [25, 40] }
      ];

      let algumaCompativel = false;
      let tabelaBombas = `
      <div class="table-responsive">
      <table class="table table-sm table-bordered align-middle mb-0">
        <thead class="table-light">
          <tr>
            <th>Bomba</th>
            <th>Faixa Vazão (m³/h)</th>
            <th>Faixa HMT (m)</th>
            <th>Status</th>
          </tr>
        </thead>
        <tbody>
      `;

      bombas.forEach(b => {
        const compativel = 
          Q_m3h >= b.faixaVazao[0] && Q_m3h <= b.faixaVazao[1] &&
          HMT >= b.faixaHMT[0] && HMT <= b.faixaHMT[1];
        if (compativel) algumaCompativel = true;
        tabelaBombas += `
          <tr>
            <td>${b.modelo}</td>
            <td>${b.faixaVazao[0]} - ${b.faixaVazao[1]}</td>
            <td>${b.faixaHMT[0]} - ${b.faixaHMT[1]}</td>
            <td>
              ${compativel 
                ? '<span class="badge bg-success"><i class="bi bi-check-circle"></i> Compatível</span>' 
                : '<span class="badge bg-warning text-dark"><i class="bi bi-exclamation-circle"></i> Fora da faixa</span>'}
            </td>
          </tr>
        `;
      });
      tabelaBombas += `</tbody></table></div>`;

      if (!algumaCompativel) {
        tabelaBombas += `<div class="alert alert-danger mt-2 mb-0"><i class="bi bi-x-circle"></i> Nenhuma bomba padrão é totalmente compatível com os parâmetros calculados. Considere revisar o projeto ou consultar o fabricante.</div>`;
      }

      // Exibir resultados em tabela
      document.getElementById("saida").classList.remove("d-none");
      document.getElementById("saida").innerHTML = `
        <h5 class="mb-3 text-primary"><i class="bi bi-bar-chart-line"></i> Resultados Técnicos</h5>
        <div class="table-responsive">
          <table class="table table-bordered align-middle mb-0">
            <tbody>
              <tr>
                <th><i class="bi bi-arrow-repeat"></i> Vazão</th>
                <td>${Q_m3h.toFixed(2)} m³/h<br><small>${Q_Lmin.toFixed(1)} L/min</small></td>
              </tr>
              <tr>
                <th><i class="bi bi-square"></i> Área da seção</th>
                <td>${A.toFixed(6)} m²</td>
              </tr>
              <tr>
                <th><i class="bi bi-speedometer2"></i> Velocidade do fluido</th>
                <td>${v.toFixed(5)} m/s <span class="text-muted"></span></td>
              </tr>
              <tr>
                <th><i class="bi bi-123"></i> Número de Reynolds</th>
                <td>${Re.toLocaleString(undefined, {maximumFractionDigits:0})}</td>
              </tr>
              <tr>
                <th><i class="bi bi-diagram-3"></i> Fator de atrito (f)</th>
                <td>${f.toFixed(4)} (${material})</td>
              </tr>
              <tr>
                <th><i class="bi bi-water"></i> Perda de carga linear (hf)</th>
                <td>${hf.toFixed(2)} m</td>
              </tr>
              <tr>
                <th><i class="bi bi-gear"></i> Perda em acessórios (~15%)</th>
                <td>${hacessorios.toFixed(2)} m</td>
              </tr>
              <tr>
                <th><i class="bi bi-graph-up-arrow"></i> Altura Manométrica Total (HMT)</th>
                <td>${HMT.toFixed(2)} m</td>
              </tr>
              <tr>
                <th><i class="bi bi-lightning-charge"></i> Sugestão de bomba</th>
                <td>${tabelaBombas}</td>
              </tr>
            </tbody>
          </table>
        </div>
      `;

      // Mostrar botões de exportação
      document.getElementById("btn-pdf").style.display = "inline-block";
      document.getElementById("btn-print").style.display = "inline-block";

      // Gráfico de curva de perda de carga
      gerarGraficoCurva(D, L, f, Hgeom, percAcessorios);
      gerarGraficoBombas(Q_m3h, HMT);

      // Scroll para resultados
      setTimeout(() => {
        document.getElementById("saida").scrollIntoView({behavior: "smooth"});
      }, 200);
    }

    function gerarGraficoCurva(D, L, f, Hgeom, percAcessorios) {
      const pi = Math.PI;
      const g = 9.81;
      const nu = 1e-6;

      // Gera pontos de vazão de 5 a 25 m³/h
      const vazoes = [];
      const hmt = [];
      for (let q = 5; q <= 25; q += 1) {
        const Q_m3s = q / 3600; // Corrigido para converter m³/h para m³/s
        const A = (pi * D * D) / 4;
        const v = Q_m3s / A;
        const Re = (v * D) / nu;
        let f_local = f;
        if (Re < 2000) f_local = 64 / Re;
        const hf = f_local * (L / D) * ((v ** 2) / (2 * g));
        const hacessorios = hf * percAcessorios;
        const HMT = Hgeom + hf + hacessorios;
        vazoes.push(q);
        hmt.push(HMT);
      }

      document.getElementById("grafico").classList.remove("d-none");
      const ctx = document.getElementById('chartHf').getContext('2d');
      if (chartHf) chartHf.destroy();
      chartHf = new Chart(ctx, {
        type: 'line',
        data: {
          labels: vazoes,
          datasets: [{
            label: 'HMT (m)',
            data: hmt,
            borderColor: '#1a237e',
            backgroundColor: 'rgba(26,35,126,0.08)',
            borderWidth: 2,
            tension: 0.25,
            pointRadius: 4,
            pointBackgroundColor: '#3949ab',
            fill: true
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: { display: false },
            tooltip: {
              callbacks: {
                label: ctx => `HMT: ${ctx.parsed.y.toFixed(2)} m`
              }
            }
          },
          scales: {
            x: {
              title: { 
                display: true, 
                text: 'Vazão (m³/h)',
                color: '#1a237e',
                font: {
                  weight: 'bold'
                }
              },
              grid: {
                color: 'rgba(26,35,126,0.05)'
              }
            },
            y: {
              title: { 
                display: true, 
                text: 'Altura Manométrica Total (m)',
                color: '#1a237e',
                font: {
                  weight: 'bold'
                }
              },
              beginAtZero: true,
              grid: {
                color: 'rgba(26,35,126,0.05)'
              }
            }
          }
        }
      });
    }

    function gerarGraficoBombas(Q_m3h, HMT) {
      const ctx = document.getElementById('graficoBombas').getContext('2d');

      const bombas = [
        { modelo: "2 CV", vazaoMin: 6, vazaoMax: 12, hmtMin: 15, hmtMax: 25, cor: "rgba(67, 160, 71, 0.2)", borderColor: "rgba(67, 160, 71, 1)" },
        { modelo: "3 CV", vazaoMin: 10, vazaoMax: 18, hmtMin: 18, hmtMax: 32, cor: "rgba(57, 73, 171, 0.2)", borderColor: "rgba(57, 73, 171, 1)" },
        { modelo: "5 CV", vazaoMin: 16, vazaoMax: 28, hmtMin: 25, hmtMax: 40, cor: "rgba(239, 108, 0, 0.2)", borderColor: "rgba(239, 108, 0, 1)" }
      ];

      if (chartBombas) chartBombas.destroy();

      const datasets = bombas.map(b => ({
        label: b.modelo,
        data: [
          { x: b.vazaoMin, y: b.hmtMax },
          { x: b.vazaoMax, y: b.hmtMin }
        ],
        backgroundColor: b.cor,
        borderColor: b.borderColor,
        borderWidth: 2,
        fill: false,
        tension: 0.4,
        pointRadius: 0
      }));

      // Adiciona ponto do sistema com os valores calculados
      datasets.push({
        label: 'Ponto do Sistema',
        data: [{ x: Q_m3h, y: HMT }],
        backgroundColor: '#ffc107',
        borderColor: '#ff9800',
        pointRadius: 8,
        pointHoverRadius: 10,
        type: 'scatter',
        showLine: false
      });

      chartBombas = new Chart(ctx, {
        type: 'line',
        data: { datasets },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            tooltip: {
              callbacks: {
                label: ctx => {
                  if (ctx.dataset.label === 'Ponto do Sistema') {
                    return `Ponto do Sistema: ${Q_m3h.toFixed(2)} m³/h, ${HMT.toFixed(2)} m`;
                  }
                  return `${ctx.dataset.label}: ${ctx.raw.x} m³/h, ${ctx.raw.y} m`;
                }
              }
            },
            legend: { 
              position: 'top',
              labels: {
                font: {
                  weight: 'bold'
                }
              }
            }
          },
          scales: {
            x: {
              title: { 
                display: true, 
                text: 'Vazão (m³/h)',
                color: '#1a237e',
                font: {
                  weight: 'bold'
                }
              },
              beginAtZero: true,
              min: 0,
              max: 30,
              grid: {
                color: 'rgba(26,35,126,0.05)'
              }
            },
            y: {
              title: { 
                display: true, 
                text: 'HMT (m)',
                color: '#1a237e',
                font: {
                  weight: 'bold'
                }
              },
              beginAtZero: true,
              min: 0,
              max: 45,
              grid: {
                color: 'rgba(26,35,126,0.05)'
              }
            }
          }
        }
      });
    }

    function limpar() {
      document.getElementById("saida").classList.add("d-none");
      document.getElementById("grafico").classList.add("d-none");
      document.getElementById("btn-pdf").style.display = "none";
      document.getElementById("btn-print").style.display = "none";
      
      // Remove validação visual
      ["volume", "tempo", "diametro", "comprimento", "altura", "material"].forEach(id => {
        document.getElementById(id).classList.remove("is-invalid");
      });
      
      if (chartHf) {
        chartHf.destroy();
        chartHf = null;
      }
      if (chartBombas) {
        chartBombas.destroy();
        chartBombas = null;
      }
    }

    // Exportar PDF usando print (modo simplificado)
    function exportarPDF() {
      window.print();
    }
  </script>
  <style media="print">
    body, html { background: #fff !important; }
    .navbar, .btn, .input-group, select, form, .chart-container { display: none !important; }
    .card { box-shadow: none !important; border: none !important; }
    .resultado { border-left: 0 !important; background: #fff !important; }
    #saida { margin-top: 0 !important; }
  </style>
</body>
</html>
<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Calculadora Hidráulica Avançada - GI Digital</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
  <style>
    body {
      background: linear-gradient(120deg, #e0eafc 0%, #cfdef3 100%);
      min-height: 100vh;
    }
    .navbar {
      border-radius: 0 0 18px 18px;
      box-shadow: 0 2px 12px rgba(13,110,253,0.08);
      background: #fff;
    }
    .navbar-brand {
      font-weight: bold;
      color: #0d6efd !important;
      font-size: 1.5rem;
      letter-spacing: 1px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .logo-gi {
      width: 38px;
      height: 38px;
      border-radius: 50%;
      background: #0d6efd;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #fff;
      font-weight: bold;
      font-size: 1.2em;
    }
    .card {
      border: none;
      border-radius: 18px;
      box-shadow: 0 6px 32px rgba(0,0,0,0.10);
      background: #fff;
    }
    .form-label {
      font-weight: 500;
    }
    .input-group-text {
      background: #e9f2ff;
      border: none;
    }
    .resultado {
      background: #f0f8ff;
      border-left: 6px solid #0d6efd;
      padding: 20px 24px;
      margin-top: 24px;
      border-radius: 10px;
      font-size: 1.08rem;
      box-shadow: 0 2px 12px rgba(13,110,253,0.07);
      animation: fadeIn 0.7s;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px);}
      to { opacity: 1; transform: translateY(0);}
    }
    .btn-primary, .btn-outline-secondary {
      font-weight: 500;
      letter-spacing: 0.5px;
    }
    .tooltip-inner {
      background: #0d6efd;
      color: #fff;
      font-size: 0.95em;
    }
    .chart-container {
      background: #f8fbff;
      border-radius: 12px;
      padding: 18px 12px;
      margin-top: 24px;
      box-shadow: 0 1px 8px rgba(13,110,253,0.06);
    }
    @media (max-width: 767px) {
      .navbar-brand { font-size: 1.1rem; }
      .logo-gi { width: 30px; height: 30px; font-size: 1em;}
      .card { padding: 1rem !important; }
      .resultado { font-size: 0.98rem; }
      .table-responsive { font-size: 0.95rem; }
    }
    .table th, .table td {
      vertical-align: middle;
    }
  </style>
</head>
<body>
  <nav class="navbar navbar-expand-lg mb-4 sticky-top">
    <div class="container">
      <a class="navbar-brand" href="#">
        <span class="logo-gi">GI</span>
        Calculadora Hidráulica Avançada
      </a>
    </div>
  </nav>
  <div class="container py-4">
    <div class="row justify-content-center">
      <div class="col-lg-8 col-md-10">
        <div class="card p-4">
          <h2 class="text-center mb-4 text-primary fw-bold">
            <i class="bi bi-droplet-half"></i> Bombeamento de Caldas Agrícolas
          </h2>
          <form id="form-calc" autocomplete="off">
            <div class="row g-3">
              <div class="col-md-6">
                <label class="form-label" for="volume">
                  Volume da calda (litros)
                  <i class="bi bi-info-circle text-primary" data-bs-toggle="tooltip" title="Volume total da calda a ser bombeada"></i>
                </label>
                <div class="input-group">
                  <span class="input-group-text"><i class="bi bi-droplet"></i></span>
                  <input type="number" id="volume" class="form-control" value="3000" min="1" required />
                </div>
              </div>
              <div class="col-md-6">
                <label class="form-label" for="tempo">
                  Tempo de transferência (min)
                  <i class="bi bi-info-circle text-primary" data-bs-toggle="tooltip" title="Tempo total de bombeamento em minutos"></i>
                </label>
                <div class="input-group">
                  <span class="input-group-text"><i class="bi bi-clock"></i></span>
                  <input type="number" id="tempo" class="form-control" value="3.5" min="0.1" step="0.1" required />
                </div>
              </div>
              <div class="col-md-6">
                <label class="form-label" for="diametro">
                  Diâmetro interno da tubulação (m)
                  <i class="bi bi-info-circle text-primary" data-bs-toggle="tooltip" title="Diâmetro interno da tubulação em metros"></i>
                </label>
                <div class="input-group">
                  <span class="input-group-text"><i class="bi bi-arrow-left-right"></i></span>
                  <input type="number" id="diametro" class="form-control" value="0.110" step="0.001" min="0.01" required/>
                </div>
              </div>
              <div class="col-md-6">
                <label class="form-label" for="comprimento">
                  Comprimento da tubulação (m)
                  <i class="bi bi-info-circle text-primary" data-bs-toggle="tooltip" title="Comprimento total da tubulação em metros"></i>
                </label>
                <div class="input-group">
                  <span class="input-group-text"><i class="bi bi-rulers"></i></span>
                  <input type="number" id="comprimento" class="form-control" value="30" min="1" required />
                </div>
              </div>
              <div class="col-md-6">
                <label class="form-label" for="altura">
                  Altura geométrica (m)
                  <i class="bi bi-info-circle text-primary" data-bs-toggle="tooltip" title="Altura vertical entre o ponto de sucção e o ponto de recalque"></i>
                </label>
                <div class="input-group">
                  <span class="input-group-text"><i class="bi bi-arrow-up"></i></span>
                  <input type="number" id="altura" class="form-control" value="2" min="0" required />
                </div>
              </div>
              <div class="col-md-6">
                <label class="form-label" for="material">
                  Material da tubulação
                  <i class="bi bi-info-circle text-primary" data-bs-toggle="tooltip" title="Selecione o material da tubulação"></i>
                </label>
                <select id="material" class="form-select" required>
                  <option value="PVC" selected>PVC</option>
                  <option value="PEAD">PEAD</option>
                  <option value="Aço">Aço</option>
                  <option value="Inox">Inox</option>
                </select>
              </div>
            </div>
            <div class="d-flex gap-2 mt-4 flex-wrap">
              <button type="button" class="btn btn-primary flex-fill" onclick="calcular()">
                <i class="bi bi-play-circle"></i> Calcular
              </button>
              <button type="reset" class="btn btn-outline-secondary flex-fill" onclick="limpar()">
                <i class="bi bi-eraser"></i> Limpar
              </button>
              <button type="button" class="btn btn-outline-primary flex-fill" id="btn-pdf" onclick="exportarPDF()" style="display:none;">
                <i class="bi bi-file-earmark-pdf"></i> Exportar PDF
              </button>
              <button type="button" class="btn btn-outline-success flex-fill" id="btn-print" onclick="window.print()" style="display:none;">
                <i class="bi bi-printer"></i> Imprimir
              </button>
            </div>
          </form>
          <div id="saida" class="resultado mt-4 d-none"></div>
          <div id="grafico" class="chart-container d-none">
            <h6 class="text-primary mb-2"><i class="bi bi-graph-up"></i> Curva de Perda de Carga x Vazão</h6>
            <canvas id="chartHf"></canvas>
          </div>
        </div>
      </div>
    </div>
  </div>
  <!-- Chart.js CDN -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // Ativa tooltips Bootstrap
    document.addEventListener('DOMContentLoaded', function () {
      var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
      tooltipTriggerList.map(function (tooltipTriggerEl) {
        return new bootstrap.Tooltip(tooltipTriggerEl)
      })
    });

    // Fatores de atrito aproximados por material
    const fatoresAtrito = {
      "PVC": 0.03,
      "PEAD": 0.028,
      "Aço": 0.022,
      "Inox": 0.015
    };

    let chartHf = null;

    function calcular() {
      const pi = Math.PI;
      const g = 9.81;
      const nu = 1e-6; // viscosidade cinemática da água a 20°C (m²/s)

      // Entradas
      const V = parseFloat(document.getElementById("volume").value);
      const T = parseFloat(document.getElementById("tempo").value);
      const D = parseFloat(document.getElementById("diametro").value);
      const L = parseFloat(document.getElementById("comprimento").value);
      const Hgeom = parseFloat(document.getElementById("altura").value);
      const material = document.getElementById("material").value;

      // Validação
      const campos = ["volume", "tempo", "diametro", "comprimento", "altura"];
      let erro = false;
      for (let id of campos) {
        const el = document.getElementById(id);
        if (!el.value || parseFloat(el.value) <= 0) {
          el.classList.add("is-invalid");
          erro = true;
        } else {
          el.classList.remove("is-invalid");
        }
      }
      if (!material) {
        document.getElementById("material").classList.add("is-invalid");
        erro = true;
      } else {
        document.getElementById("material").classList.remove("is-invalid");
      }
      if (erro) {
        document.getElementById("saida").classList.remove("d-none");
        document.getElementById("saida").innerHTML = `<div class="alert alert-danger"><i class="bi bi-exclamation-triangle"></i> Preencha todos os campos corretamente!</div>`;
        document.getElementById("grafico").classList.add("d-none");
        document.getElementById("btn-pdf").style.display = "none";
        document.getElementById("btn-print").style.display = "none";
        return;
      }

      // Cálculos principais
      const Q_m3h = (V / T) * (60 / 1000); // m³/h
      const Q_Lmin = Q_m3h * 1000 / 60; // L/min
      const Q_m3s = Q_m3h / 3.6; // m³/s
      const A = (pi * D * D) / 4; // m²
      const v = (Q_m3s / A) / 1000; // m/s (dividido por 1000 conforme solicitado)
      const Re = (v * D) / nu; // Número de Reynolds

      // Fator de atrito
      let f = fatoresAtrito[material] || 0.03;

      // Ajuste para regime laminar (Re < 2000)
      if (Re < 2000) {
        f = 64 / Re;
      }

      // Perda de carga linear (Darcy-Weisbach)
      const hf = f * (L / D) * ((v ** 2) / (2 * g));

      // Perda em acessórios (estimativa 15% de hf)
      const percAcessorios = 0.15;
      const hacessorios = hf * percAcessorios;

      // HMT
      const HMT = Hgeom + hf + hacessorios;

      // Tabela de bombas exemplo
      const bombas = [
        { modelo: "2 CV", faixaVazao: [6, 12], faixaHMT: [15, 25] },
        { modelo: "3 CV", faixaVazao: [10, 18], faixaHMT: [18, 32] },
        { modelo: "5 CV", faixaVazao: [16, 28], faixaHMT: [25, 40] }
      ];

      let algumaCompativel = false;
      let tabelaBombas = `
      <div class="table-responsive">
      <table class="table table-sm table-bordered align-middle mb-0">
        <thead class="table-light">
          <tr>
            <th>Bomba</th>
            <th>Faixa Vazão (m³/h)</th>
            <th>Faixa HMT (m)</th>
            <th>Status</th>
          </tr>
        </thead>
        <tbody>
      `;

      bombas.forEach(b => {
        const compativel = 
          Q_m3h >= b.faixaVazao[0] && Q_m3h <= b.faixaVazao[1] &&
          HMT >= b.faixaHMT[0] && HMT <= b.faixaHMT[1];
        if (compativel) algumaCompativel = true;
        tabelaBombas += `
          <tr>
            <td>${b.modelo}</td>
            <td>${b.faixaVazao[0]} - ${b.faixaVazao[1]}</td>
            <td>${b.faixaHMT[0]} - ${b.faixaHMT[1]}</td>
            <td>
              ${compativel 
                ? '<span class="badge bg-success"><i class="bi bi-check-circle"></i> Compatível</span>' 
                : '<span class="badge bg-warning text-dark"><i class="bi bi-exclamation-circle"></i> Fora da faixa</span>'}
            </td>
          </tr>
        `;
      });
      tabelaBombas += `</tbody></table></div>`;

      if (!algumaCompativel) {
        tabelaBombas += `<div class="alert alert-danger mt-2 mb-0"><i class="bi bi-x-circle"></i> Nenhuma bomba padrão é totalmente compatível com os parâmetros calculados. Considere revisar o projeto ou consultar o fabricante.</div>`;
      }

      // Exibir resultados em tabela
      document.getElementById("saida").classList.remove("d-none");
      document.getElementById("saida").innerHTML = `
        <h5 class="mb-3 text-primary"><i class="bi bi-bar-chart-line"></i> Resultados Técnicos</h5>
        <div class="table-responsive">
          <table class="table table-bordered align-middle mb-0">
            <tbody>
              <tr>
                <th><i class="bi bi-arrow-repeat"></i> Vazão</th>
                <td>${Q_m3h.toFixed(2)} m³/h<br><small>${Q_Lmin.toFixed(1)} L/min</small></td>
              </tr>
              <tr>
                <th><i class="bi bi-square"></i> Área da seção</th>
                <td>${A.toFixed(6)} m²</td>
              </tr>
              <tr>
                <th><i class="bi bi-speedometer2"></i> Velocidade do fluido</th>
                <td>${v.toFixed(5)} m/s <span class="text-muted">(valor dividido por 1000)</span></td>
              </tr>
              <tr>
                <th><i class="bi bi-123"></i> Número de Reynolds</th>
                <td>${Re.toLocaleString(undefined, {maximumFractionDigits:0})}</td>
              </tr>
              <tr>
                <th><i class="bi bi-diagram-3"></i> Fator de atrito (f)</th>
                <td>${f.toFixed(4)} (${material})</td>
              </tr>
              <tr>
                <th><i class="bi bi-water"></i> Perda de carga linear (hf)</th>
                <td>${hf.toFixed(2)} m</td>
              </tr>
              <tr>
                <th><i class="bi bi-gear"></i> Perda em acessórios (~15%)</th>
                <td>${hacessorios.toFixed(2)} m</td>
              </tr>
              <tr>
                <th><i class="bi bi-graph-up-arrow"></i> Altura Manométrica Total (HMT)</th>
                <td>${HMT.toFixed(2)} m</td>
              </tr>
              <tr>
                <th><i class="bi bi-lightning-charge"></i> Sugestão de bomba</th>
                <td>${tabelaBombas}</td>
              </tr>
            </tbody>
          </table>
        </div>
      `;

      // Mostrar botões de exportação
      document.getElementById("btn-pdf").style.display = "inline-block";
      document.getElementById("btn-print").style.display = "inline-block";

      // Gráfico de curva de perda de carga
      gerarGraficoCurva(D, L, f, Hgeom, 0.15);

      // Scroll para resultados
      setTimeout(() => {
        document.getElementById("saida").scrollIntoView({behavior: "smooth"});
      }, 200);
    }

    function gerarGraficoCurva(D, L, f, Hgeom, percAcessorios) {
      const pi = Math.PI;
      const g = 9.81;
      const nu = 1e-6;

      // Gera pontos de vazão de 5 a 25 m³/h
      const vazoes = [];
      const hmt = [];
      for (let q = 5; q <= 25; q += 1) {
        const Q_m3s = q / 3.6;
        const A = (pi * D * D) / 4;
        const v = (Q_m3s / A) / 1000; // Dividido por 1000
        const Re = (v * D) / nu;
        let f_local = f;
        if (Re < 2000) f_local = 64 / Re;
        const hf = f_local * (L / D) * ((v ** 2) / (2 * g));
        const hacessorios = hf * percAcessorios;
        const HMT = Hgeom + hf + hacessorios;
        vazoes.push(q);
        hmt.push(HMT);
      }

      document.getElementById("grafico").classList.remove("d-none");
      const ctx = document.getElementById('chartHf').getContext('2d');
      if (chartHf) chartHf.destroy();
      chartHf = new Chart(ctx, {
        type: 'line',
        data: {
          labels: vazoes,
          datasets: [{
            label: 'HMT (m)',
            data: hmt,
            borderColor: '#0d6efd',
            backgroundColor: 'rgba(13,110,253,0.08)',
            tension: 0.25,
            pointRadius: 2,
            fill: true
          }]
        },
        options: {
          responsive: true,
          plugins: {
            legend: { display: false },
            tooltip: {
              callbacks: {
                label: ctx => `HMT: ${ctx.parsed.y.toFixed(2)} m`
              }
            }
          },
          scales: {
            x: {
              title: { display: true, text: 'Vazão (m³/h)' }
            },
            y: {
              title: { display: true, text: 'Altura Manométrica Total (m)' },
              beginAtZero: true
            }
          }
        }
      });
    }

    function limpar() {
      document.getElementById("saida").classList.add("d-none");
      document.getElementById("grafico").classList.add("d-none");
      document.getElementById("btn-pdf").style.display = "none";
      document.getElementById("btn-print").style.display = "none";
      // Remove validação visual
      ["volume", "tempo", "diametro", "comprimento", "altura", "material"].forEach(id => {
        document.getElementById(id).classList.remove("is-invalid");
      });
      if (chartHf) chartHf.destroy();
    }

    // Exportar PDF usando print (modo simplificado)
    function exportarPDF() {
      window.print();
    }
  </script>
  <style media="print">
    body, html { background: #fff !important; }
    .navbar, .btn, .input-group, select, form, .chart-container { display: none !important; }
    .card { box-shadow: none !important; border: none !important; }
    .resultado { border-left: 0 !important; background: #fff !important; }
    #saida { margin-top: 0 !important; }
  </style>
</body>
</html>